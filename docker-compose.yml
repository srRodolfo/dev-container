services:
  # PHP-FPM
  php:
    build:
      context: ./docker/php
      args:
        PHP_VERSION: ${PHP_VERSION:-8.2}
    image: dev-container-php:${PHP_VERSION:-8.2}-fpm
    container_name: ${PROJECT_NAME:-dev_container}_php
    volumes:
      - ./src:/var/www/html
    environment:
      PUID: ${PUID:-1000}  # UID do seu usu√°rio no host
      PGID: ${PGID:-1000}
    ports:
      - ${PHP_PORT:-9000}:9000
    networks:
      - net

  # Apache
  apache:
    build: ./docker/apache
    image: dev-container-apache:2.4
    container_name: ${PROJECT_NAME:-dev_container}_apache
    ports:
      - ${APACHE_PORT:-8080}:80
    volumes:
      - ./src:/var/www/html
      - ./docker/apache/my-project.conf:/usr/local/apache2/conf/extra/httpd-vhosts.conf
    depends_on:
      - php
    networks:
      - net
    command: [httpd-foreground]

  # MariaDB
  mysql:
    image: mariadb:11
    container_name: ${PROJECT_NAME:-dev_container}_mariadb
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-root_password}
      MYSQL_DATABASE: ${MYSQL_DATABASE:-database_name}
      MYSQL_USER: ${MYSQL_USER:-database_user}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD:-user_password}
    ports:
      - ${MYSQL_PORT:-3306}:3306
    volumes:
      - mysql_data:/var/lib/mysql
      - ./docker/mysql/my.cnf:/etc/mysql/conf.d/my.cnf
    networks:
      - net

networks:
  net:
    driver: bridge

volumes:
  mysql_data:
